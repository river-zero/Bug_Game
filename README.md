## 벌레 게임
게임은 총 두 가지 단계로 구성되어 있습니다. 1단계는 사방으로 돌아다니는 벌레들을 왼쪽 마우스로 클릭해 모두 제거하면 클리어됩니다. 2단계는 마우스를 향해 다가오는 벌레들로부터 7초 동안 버티면 클리어됩니다. 해당 프로젝트는 Direct2D를 이용해 구현하였습니다.

## 플레이 영상

## 클래스 설계도
![클래스 설계도](/out/Bug_Game/Bug_Game.png)

## 주요 기능
- 벌레 랜덤 생성 및 움직임 구현
  - mt19937 난수 생성기 및 std::uniform_real_distribution를 사용하여 균등한 분포의 랜덤한 위치에 벌레를 생성하였습니다.
  - std::clamp를 활용하여 벌레가 화면을 벗어나지 않도록 위치를 제한하였습니다.
  - mIsClickable 변수가 거짓이라면 마우스 위치를 향해 벌레 이미지가 따라오도록 벡터를 사용해 구현하였습니다.
- 시간 관리
  - std::chrono를 사용하여 시간을 측정하고, 게임에서 시간과 관련된 작업을 구현하였습니다.
- 그래픽 처리
  - D2DFramework 클래스를 통해 Direct2D 및 DirectWrite를 초기화하고, 이미지와 텍스트를 화면에 렌더링하였습니다.
  - BitmapManager 클래스에서 싱글턴 패턴을 적용해 전역적으로 여러 이미지를 중복 없이 관리하고, Direct2D의 ID2D1Bitmap 및 WIC를 이용하여 이미지를 처리하였습니다.
- 게임 다시 시작 기능
  - ResetGame 함수를 통해 필요한 초기화 작업을 수행, 게임을 처음부터 다시 시작할 수 있도록 구현하였습니다.

## 시행착오
> 초기에는 벌레의 움직임을 구현하기 위해서 열거형으로 8가지 방향을 설정해 움직이도록 하였습니다. 그러나 이미지가 방향이 틀어지고 움직이는 것이 아닌 벌레가 고정된 그 상태 그대로 움직이게 되어 원하는 방식대로 구현되지 않았습니다. 따라서 해당 움직임을 구현하기 위해서 벡터와 행렬을 적용하는 방식을 배우게 되었고 원하는 방향을 설정할 UPVECTOR, 변환을 나타내는 행렬인 D2D1::Matrix3x2F, 그리고 행렬 곱셈을 사용해 원하는 움직임을 구현하였습니다. 해당 방식을 사용함으로써 물체의 움직임과 변환을 더 자연스럽게 다룰 수 있게 되었고, GPU에서 복잡한 연산을 처리해 매우 빠른 처리가 가능해졌습니다. 또한, 이미지 깨짐 현상도 자연스럽게 보간할 수 있게 되어 성능과 시각적인 품질 향상에 도움이 되었습니다.

> 위 작업을 거쳤지만 여전히 움직임이 부드럽지 못함을 느껴 조금 더 자연스러운 벌레의 움직임을 구현하고자 하였습니다. 따라서 목표 회전 각도를 멤버 변수로 추가하고, 해당 목표 회전 각도가 될 때까지 조금식 이동 및 회전을 하도록 Bug::Draw 함수 코드를 수정하였습니다. 실행 결과 이미지들이 부드럽게 회전하면서 이동을 하지만 위쪽으로 쏠려 이동하는 문제가 발생하였습니다. 해당 문제를 해결하기 위해서 벌레 이미지들이 생성할 때 시작부터 서로 다른 방향을 가지도록 mRotation 초기화 코드를 수정하였고, 원하는 결과물을 얻게 되었습니다.

> 1단계를 클리어하고 나면 화면에 문구가 출력이 되고, 마우스 왼쪽 버튼을 누르면 2단계로 넘어가도록 하고자 하였습니다. 그런데, 두 번째 벌레 이미지가 생성되는 것은 잘 작동하였으나 마우스 왼쪽 버튼을 누루는 순간 거의 동시에 문구 출력과 벌레 이미지 생성이 이루어져 문구 출력 텍스트가 보이지 않는 문제가 발생했습니다. 이를 해결하기 위해 mBugGenerated 멤버 변수를 추가하였고, 문구 출력 부분과 벌레 이미지 생성 부분 사이에 Sleep(50); 코드를 추가해 간단하게 해결하였습니다.

> 2단계가 시작되고 나서 7초를 버티면 성공, 버티지 못하고 벌레와 마우스가 닿으면 실패 문구를 출력하도록 구현하고자 하였습니다. 7초를 버티면 성공 문구를 출력하는 것까지 완성시켰으나 어째서인지 마우스와 벌레가 서로 닿아도 실패 문구로 전환되지 않는 문제가 발생했습니다. 왜 이런 문제가 발생하는 것인지 코드를 자세히 살펴보았고, Bug 클래스 내 IsClicked 함수에서 Bug의 영역에 클릭이 발생하면 mIsDead를 true로 설정하는 부분에서 if문 조건 중 mIsClickable이 참인 경우에만 mIsDead를 변경 가능한 것을 발견했습니다. mIsClickable 조건이 필요없으므로 삭제하였고, 성공/실패 화면 또한 조건에 맞게 그려지는 것을 확인했습니다.

> 해당 게임을 친구들에게 플레이해보고 의견을 남겨달라고 하였습니다. 2단계 게임이 시작되기 전에 3, 2, 1을 화면에 출력해 준비할 시간을 주고, 실패하거나 성공하면 다시 시작할 수 있도록 해달라는 피드백을 받았습니다. 해당 의견을 수렴해 두 번째 벌레 생성 전 Sleep(1000);와 텍스트 코드를 추가하였고, EndDraw와 BeginDraw로 강제로 화면을 갱신해 3초 카운트다운 기능을 구현하였습니다. 그리고 ResetGame 함수를 추가해 필요한 변수들을 초기화하여 게임을 처음부터 다시 시작할 수 있도록 구현하였습니다.

## 리소스 목록
|      이름      |   설명    |
| :------------: | :-------: |
| background.jpg |   배경    |
|    bug1.png    | 빨간 벌레 |
|    bug2.png    | 노란 벌레 |

## 출처
- https://www.freepik.com/free-vector/hand-drawn-colorful-bug-collection_4176860.htm#query=bug&position=5&from_view=search&track=sph
- https://www.freepik.com/free-photo/design-space-paper-textured-background_3220799.htm#from_view=detail_author
